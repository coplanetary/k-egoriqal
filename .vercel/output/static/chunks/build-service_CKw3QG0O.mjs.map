{"version":3,"file":"build-service_CKw3QG0O.mjs","sources":["../../../../node_modules/@astrojs/vercel/dist/image/shared.js","../../../../node_modules/@astrojs/vercel/dist/image/build-service.js"],"sourcesContent":["function getDefaultImageConfig(astroImageConfig) {\n  return {\n    sizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],\n    domains: astroImageConfig.domains ?? [],\n    // Cast is necessary here because Vercel's types are slightly different from ours regarding allowed protocols. Behavior should be the same, however.\n    remotePatterns: astroImageConfig.remotePatterns ?? []\n  };\n}\nfunction isESMImportedImage(src) {\n  return typeof src === \"object\";\n}\nconst qualityTable = {\n  low: 25,\n  mid: 50,\n  high: 80,\n  max: 100\n};\nfunction getAstroImageConfig(images, imagesConfig, command, devImageService, astroImageConfig) {\n  let devService = \"@astrojs/vercel/dev-image-service\";\n  switch (devImageService) {\n    case \"sharp\":\n      devService = \"@astrojs/vercel/dev-image-service\";\n      break;\n    case \"squoosh\":\n      devService = \"@astrojs/vercel/squoosh-dev-image-service\";\n      break;\n    default:\n      if (typeof devImageService === \"string\") {\n        devService = devImageService;\n      } else {\n        devService = \"@astrojs/vercel/dev-image-service\";\n      }\n      break;\n  }\n  if (images) {\n    return {\n      image: {\n        service: {\n          entrypoint: command === \"dev\" ? devService : \"@astrojs/vercel/build-image-service\",\n          config: imagesConfig ? imagesConfig : getDefaultImageConfig(astroImageConfig)\n        }\n      }\n    };\n  }\n  return {};\n}\nfunction sharedValidateOptions(options, serviceConfig, mode) {\n  const vercelImageOptions = serviceConfig;\n  if (mode === \"development\" && (!vercelImageOptions.sizes || vercelImageOptions.sizes.length === 0)) {\n    throw new Error(\"Vercel Image Optimization requires at least one size to be configured.\");\n  }\n  const configuredWidths = vercelImageOptions.sizes.sort((a, b) => a - b);\n  if (!options.width) {\n    const src = options.src;\n    if (isESMImportedImage(src)) {\n      const nearestWidth = configuredWidths.reduce((prev, curr) => {\n        return Math.abs(curr - src.width) < Math.abs(prev - src.width) ? curr : prev;\n      });\n      options.inputtedWidth = src.width;\n      options.width = nearestWidth;\n    } else {\n      throw new Error(`Missing \\`width\\` parameter for remote image ${options.src}`);\n    }\n  } else {\n    if (!configuredWidths.includes(options.width)) {\n      const nearestWidth = configuredWidths.reduce((prev, curr) => {\n        return Math.abs(curr - options.width) < Math.abs(prev - options.width) ? curr : prev;\n      });\n      options.inputtedWidth = options.width;\n      options.width = nearestWidth;\n    }\n  }\n  if (options.quality && typeof options.quality === \"string\") {\n    options.quality = options.quality in qualityTable ? qualityTable[options.quality] : void 0;\n  }\n  if (!options.quality) {\n    options.quality = 100;\n  }\n  return options;\n}\nexport {\n  getAstroImageConfig,\n  getDefaultImageConfig,\n  isESMImportedImage,\n  qualityTable,\n  sharedValidateOptions\n};\n","import { isESMImportedImage, sharedValidateOptions } from \"./shared.js\";\nconst service = {\n  validateOptions: (options, serviceOptions) => sharedValidateOptions(options, serviceOptions.service.config, \"production\"),\n  getHTMLAttributes(options) {\n    const { inputtedWidth, ...props } = options;\n    if (inputtedWidth) {\n      props.width = inputtedWidth;\n    }\n    let targetWidth = props.width;\n    let targetHeight = props.height;\n    if (isESMImportedImage(props.src)) {\n      const aspectRatio = props.src.width / props.src.height;\n      if (targetHeight && !targetWidth) {\n        targetWidth = Math.round(targetHeight * aspectRatio);\n      } else if (targetWidth && !targetHeight) {\n        targetHeight = Math.round(targetWidth / aspectRatio);\n      } else if (!targetWidth && !targetHeight) {\n        targetWidth = props.src.width;\n        targetHeight = props.src.height;\n      }\n    }\n    const { src, width, height, format, quality, ...attributes } = props;\n    return {\n      ...attributes,\n      width: targetWidth,\n      height: targetHeight,\n      loading: attributes.loading ?? \"lazy\",\n      decoding: attributes.decoding ?? \"async\"\n    };\n  },\n  getURL(options) {\n    const fileSrc = isESMImportedImage(options.src) ? removeLeadingForwardSlash(options.src.src) : options.src;\n    const searchParams = new URLSearchParams();\n    searchParams.append(\"url\", fileSrc);\n    options.width && searchParams.append(\"w\", options.width.toString());\n    options.quality && searchParams.append(\"q\", options.quality.toString());\n    return \"/_vercel/image?\" + searchParams;\n  }\n};\nfunction removeLeadingForwardSlash(path) {\n  return path.startsWith(\"/\") ? path.substring(1) : path;\n}\nvar build_service_default = service;\nexport {\n  build_service_default as default\n};\n"],"names":[],"mappings":"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","x_google_ignoreList":[0,1]}